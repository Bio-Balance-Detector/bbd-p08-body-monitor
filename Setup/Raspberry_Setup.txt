# https://behroozbc.hashnode.dev/install-net-on-a-raspberry-pi

sudo apt update
sudo apt install wget

$ wget https://dot.net/v1/dotnet-install.sh

sudo bash ./dotnet-install.sh --channel STS --install-dir /opt/dotnet/

sudo ln -s /opt/dotnet/dotnet /usr/local/bin

echo 'export DOTNET_ROOT=/opt/dotnet' >> /home/pi/.bashrc

dotnet --info


x, Clone the repo on the Raspberry
cd ~/Work/BioBalanceDetector
git clone https://github.com/andrasfuchs/BioBalanceDetector.git

x, Update the repo on the Raspberry
cd ~/Work/BioBalanceDetector
git pull

x, Build the .NET source code on the Raspberry
cd ~/Work/BioBalanceDetector/Software/Source/BBDProto08/BBD.SleepLogger
dotnet build

x, Publish the .NET app on the Raspberry
cd ~/Work/BioBalanceDetector/Software/Source/BBDProto08/BBD.SleepLogger
dotnet publish --configuration release --runtime linux-arm --self-contained true --output ~/Work/BBD.SleepLogger

x, Run the .NET app on the Raspberry
cd ~/Work/BBD.SleepLogger
./BBD.SleepLogger

x, Configure the .NET 5 app to run as background services
sudo apt-get install supervisor

sudo nano /etc/supervisor/supervisord.conf
# change chmod=0700 to chmod=0766 @ line 5

sudo nano /etc/supervisor/conf.d/bbd.conf

[group:bbd]
programs=SleepLogger

[program:SleepLogger]
directory=/home/pi/Work/BBD.SleepLogger
command=/home/pi/Work/BBD.SleepLogger/BBD.SleepLogger
autostart=true
autorestart=true
stderr_logfile=/var/log/BBD.SleepLogger.err.log
stdout_logfile=/var/log/BBD.SleepLogger.out.log
user=pi
environment=HOME="/home/pi",USER="pi"
stopsignal=INT
stopasgroup=false


sudo service supervisor restart

supervisorctl status all
supervisorctl stop bbd:
supervisorctl start bbd:
